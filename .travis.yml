sudo: required
dist: trusty

services:
  - docker
branches:
    only:
      - master

jobs:
  include:
    - stage: lint-scripts
      if: branch != master
      name: "Lint shell scripts"
      script:
        - 'if [ "$TRAVIS_PULL_REQUEST" != "false" ]; then ./test/lint-scripts.sh; fi'
    - stage: charts-testing
      if: branch != master
      name: "Lint charts"
      env:
        - CHART_TESTING_TAG="v2.0.0"
        - CHARTS_REPO="https://github.com/rimusz-lab/bk-charts"
      script:
        - 'if [ "$TRAVIS_PULL_REQUEST" != "false" ]; then ./test/lint-charts.sh; fi'
    - stage: publish-charts
      if: branch = master
      name: "Publish charts"
      env:
        - HELM_VERSION=v2.11.0
      script:
        - 'if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then bash ./.scripts/repo-sync.sh true; fi'

stages:
  - lint-scripts
  - charts-testing
  - publish-charts
